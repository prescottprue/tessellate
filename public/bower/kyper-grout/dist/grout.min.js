function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,r){for(var n=!0;n;){var o=e,i=t,s=r;c=u=a=void 0,n=!1,null===o&&(o=Function.prototype);var c=Object.getOwnPropertyDescriptor(o,i);if(void 0!==c){if("value"in c)return c.value;var a=c.get;return void 0===a?void 0:a.call(s)}var u=Object.getPrototypeOf(o);if(null===u)return void 0;e=u,t=i,r=s,n=!0}},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("jwt-decode"),require("superagent"),require("aws-sdk"),require("firebase")):"function"==typeof define&&define.amd?define(["lodash","jwt-decode","superagent","aws-sdk","firebase"],t):e.Grout=t(e._,e.jwtDecode,e.superagent,e.AWS,e.Firebase)}(this,function(e,t,r,n,o){"use strict";function i(e,t){return e&&console[e]?console[e].apply(console,t):console.log.apply(console,t)}function s(t){var r="",n={};e.isObject(t)?("debug"==m&&e.has(t,"func")&&(r+=e.has(t,"obj")?"["+t.obj+"."+t.func+"()]\n ":e.has(t,"file")?"["+t.file+" > "+t.func+"()]\n ":"["+t.func+"()]\n "),e.each(e.omit(e.keys(t)),function(o,i,s){"func"!=o&&"obj"!=o&&("description"==o||"message"==o?r+=t[o]:n[o]=e.isString(t[o])?t[o]:t[o])}),r+="\n"):e.isString(t)&&(r=t);var o=[r,n];return o}function c(e){var r=void 0;if(e&&""!=e)try{r=t(e)}catch(n){throw b.error({description:"Error decoding token.",data:r,error:n,func:"decodeToken",file:"token"}),new Error("Invalid token string.")}return r}function a(e){return new Promise(function(t,r){e.end(function(e,n){return e?(401==e.status&&console.warn("Unauthorized. You must be signed into make this request."),r(e)):t(n.body)})})}function u(e){return A.string&&(e=e.set("Authorization","Bearer "+A.string),console.info({message:"Set auth header",func:"addAuthHeader",file:"request"})),e}function p(){n.config.update({credentials:new n.CognitoIdentityCredentials({IdentityPoolId:P.aws.cognito.poolId}),region:P.aws.region})}function l(){n.config.update({credentials:new n.CognitoIdentityCredentials({IdentityPoolId:P.aws.cognito.poolId}),region:P.aws.region})}function d(e){var t=e.map(function(e){return f(e)});return g(t)}function f(t){var r;e.has(t,"path")?r=t.path.split("/"):(r=t.Key.split("/"),t=e.pick(t,"Key"),t.path=t.Key,t.name=t.Key);var n=t;if(1==r.length)return n.name=r[0],e.has(n,"type")||(n.type="file"),n.path=r[0],n;var o={};return e.each(r,function(i,s,c){s!=c.length-1?(n.name=i,n.path=e.take(c,s+1).join("/"),n.type="folder",n.children=[{}],0==s&&(o=n),n=n.children[0]):(n.type="file",n.name=i,n.path=r.join("/"),t.$id&&(n.$id=t.$id))}),o}function g(t){var r=[],n=[];return e.each(t,function(o,i,s){if(-1==r.indexOf(o.name))r.push(o.name),n.push(o);else{var c=e.findWhere(t,{name:o.name});c.children=e.union(o.children,c.children),c.children=g(c.children)}}),n}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t,r="default"in r?r["default"]:r,n="default"in n?n["default"]:n,o="default"in o?o["default"]:o;var h={serverUrl:"http://tessellate.elasticbeanstalk.com",tokenName:"tessellate",tokenDataName:"tessellate-tokenData",tokenUserDataName:"tessellate-currentUser"},m="debug";h.logLevel&&(m=h.logLevel);var b={log:function(e){var t=s(e);"production"==h.envName?i("log",t):i("log",t)},info:function(e){var t=s(e);"production"==h.envName?i("info",t):i("info",t)},warn:function(e){var t=s(e);"production"==h.envName?i("warn",t):i("warn",t)},debug:function(e){var t=s(e);"production"==h.envName||i("debug",t)},error:function(e){var t=s(e);"production"==h.envName?i("error",t):i("error",t)}},j={loadCss:function(e){if(document){var t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("head")[0].insertBefore(t,document.getElementsByTagName("head")[0].firstChild),b.log({description:"CSS was loaded into document.",element:t,func:"loadCss",obj:"dom"}),t}throw b.error({description:"Document does not exsist to load assets into.",func:"loadCss",obj:"dom"}),new Error("Document object is required to load assets.")},loadJs:function(t){if(window&&!e.has(window,"document"))throw b.error({description:"Document does not exsist to load assets into.",func:"loadCss",obj:"dom"}),new Error("Document object is required to load assets.");var r=window.document.createElement("script");return r.src=t,r.type="text/javascript",window.document.getElementsByTagName("head")[0].appendChild(r),b.log({description:"JS was loaded into document.",element:r,func:"loadCss",obj:"dom"}),r},asyncLoadJs:function(t){if(e.has(window,"document")){var r=window.document.createElement("script");return r.src=t,r.type="text/javascript",window.document.getElementsByTagName("head")[0].appendChild(r),b.log({description:"JS was loaded into document.",element:r,func:"loadCss",obj:"dom"}),new Promise(function(e,t){window.setTimeout(e,30)})}throw b.error({description:"Document does not exsist to load assets into.",func:"loadCss",obj:"dom"}),new Error("Document object is required to load assets.")}},y={},v=Object.defineProperties({item:function(e,t){return this.setItem(e,t)},setItem:function(t,r){y[t]=r,this.localExists&&(e.isObject(r)&&(r=JSON.stringify(r)),window.sessionStorage.setItem(t,r))},getItem:function(e){if(y[e])return y[e];if(this.localExists){var t=window.sessionStorage.getItem(e);if(t){var r=!1,n=null;try{n=JSON.parse(t),r=!0}catch(o){r=!1}if(r)return n}return t}return null},removeItem:function(e){if(y[e]&&(y[e]=null),this.localExists)try{window.sessionStorage.removeItem(e)}catch(t){b.error({description:"Error removing item from session storage",error:t,obj:"storage",func:"removeItem"})}},clear:function(){if(y={},this.localExists)try{window.sessionStorage.clear()}catch(e){b.warn("Session storage could not be cleared.",e)}}},{localExists:{get:function(){var e="test";if("undefined"==typeof window||"undefined"==typeof window.sessionStorage)return!1;try{return window.sessionStorage.setItem(e,"1"),window.sessionStorage.removeItem(e),!0}catch(t){return b.error({description:"Error saving to session storage",error:t,obj:"storage",func:"localExists"}),!1}},configurable:!0,enumerable:!0}}),A=Object.defineProperties({save:function(e){this.string=e},"delete":function(){v.removeItem(h.tokenName),v.removeItem(h.tokenDataName),b.log({description:"Token was removed.",func:"delete",obj:"token"})}},{string:{get:function(){return v.getItem(h.tokenName)},set:function(e){b.log({description:"Token was set.",token:e,func:"string",obj:"token"}),this.data=t(e),v.setItem(h.tokenName,e)},configurable:!0,enumerable:!0},data:{get:function(){return v.getItem(h.tokenDataName)?v.getItem(h.tokenDataName):c(this.string)},set:function(t){if(e.isString(t)){var r=t;t=c(r),b.info({description:"Token data was set as string. Decoding token.",token:r,tokenData:t,func:"data",obj:"token"})}else b.log({description:"Token data was set.",data:t,func:"data",obj:"token"}),v.setItem(h.tokenDataName,t)},configurable:!0,enumerable:!0}}),w={get:function(e,t){var n=r.get(e);return t&&n.query(t),n=u(n),a(n)},post:function(e,t){var n=r.post(e).send(t);return n=u(n),a(n)},put:function(e,t){var n=r.put(e).send(t);return n=u(n),a(n)},del:function(e,t){var n=r.put(e).send(t);return n=u(n),a(n)}},k={},D=function(){function e(t){_classCallCheck(this,e),this.app=t.app?t.app:null,this.redirectUri=t.redirectUri?t.redirectUri:"redirect.html",this.provider=t.provider?t.provider:null}return _createClass(e,[{key:"loadHello",value:function(){return window&&!window.hello?j.asyncLoadJs("https://s3.amazonaws.com/kyper-cdn/js/hello.js"):Promise.resolve()}},{key:"helloLoginListener",value:function(){window.hello.on("auth.login",function(e){b.info({description:"User logged in to google.",func:"loadHello",obj:"Google"}),window.hello(e.network).api("/me").then(function(t){var r=t;return r.provider=e.network,w.post(this.endpoint+"/provider",r).then(function(e){return b.log({description:"Provider request successful.",response:e,func:"signup",obj:"GoogleUtil"}),e})["catch"](function(e){return b.error({description:"Error requesting login.",error:e,func:"signup",obj:"Matter"}),Promise.reject(e)})})})}},{key:"initHello",value:function(){var e=this;return this.loadHello().then(function(){return w.get(e.app.endpoint+"/providers").then(function(t){b.log({description:"Provider request successful.",response:t,func:"signup",obj:"ProviderAuth"});var r=t[e.provider];return b.warn({description:"Provider found",provider:r,func:"login",obj:"ProviderAuth"}),r?(b.warn({description:"Providers config built",providersConfig:t,func:"login",obj:"ProviderAuth"}),window.hello.init(t,{redirect_uri:"redirect.html"})):(b.error({description:"Provider is not setup. Visit tessellate.kyper.io to enter your client id for "+e.provider,provider:e.provider,clientIds:k,func:"login",obj:"ProviderAuth"}),Promise.reject({message:"Provider is not setup."}))})["catch"](function(e){return b.error({description:"Getting application data.",error:e,func:"signup",obj:"Matter"}),Promise.reject(e)})})}},{key:"login",value:function(){var e=this;return this.initHello().then(function(){return window.hello.login(e.provider)})}},{key:"signup",value:function(){var e=this;return this.initHello().then(function(){return window.hello.login(e.provider)},function(e){return b.error({description:"Error signing up.",error:e,func:"signup",obj:"Matter"}),Promise.reject({message:"Error signing up."})})}}]),e}(),E=function(){function t(e,r){if(_classCallCheck(this,t),!e)throw b.error({description:"Application name requires to use Matter.",func:"constructor",obj:"Matter"}),new Error("Application name is required to use Matter");this.name=e,r&&(this.options=r)}return _createClass(t,[{key:"signup",value:function(t){if(b.log({description:"Signup called.",signupData:t,func:"signup",obj:"Matter"}),!t)return b.error({description:"Signup information is required to signup.",func:"signup",obj:"Matter"}),Promise.reject({message:"Login data is required to login."});if(e.isObject(t))return w.post(this.endpoint+"/signup",t).then(function(r){return b.log({description:"Account request successful.",signupData:t,response:r,func:"signup",obj:"Matter"}),e.has(r,"account")?r.account:(b.warn({description:"Account was not contained in signup response.",signupData:t,response:r,func:"signup",obj:"Matter"}),r)})["catch"](function(e){return b.error({description:"Error requesting signup.",signupData:t,error:e,func:"signup",obj:"Matter"}),Promise.reject(e)});if(e.isString(t)){var r=new D({provider:t,app:this});return r.signup(t).then(function(e){return b.info({description:"Provider signup successful.",provider:t,res:e,func:"signup",obj:"Matter"}),Promise.resolve(e)})}return b.error({description:"Incorrectly formatted signup information.",signupData:t,func:"signup",obj:"Matter"}),Promise.reject({message:"Signup requires an object or a string."})}},{key:"login",value:function(t){var r=this;if(!t)return b.error({description:"Username/Email and Password are required to login",func:"login",obj:"Matter"}),Promise.reject({message:"Login data is required to login."});if(e.isObject(t))return t.password&&t.username?w.put(this.endpoint+"/login",t).then(function(t){return e.has(t,"data")&&e.has(t.data,"status")&&409==t.data.status?(b.warn({description:"Account not found.",response:t,func:"login",obj:"Matter"}),Promise.reject(t.data)):(b.log({description:"Successful login.",response:t,func:"login",obj:"Matter"}),e.has(t,"token")&&(r.token.string=t.token),e.has(t,"account")&&r.storage.setItem(h.tokenUserDataName,t.account),t.account)})["catch"](function(e){return b.error({description:"Error requesting login.",error:e,status:e.status,func:"login",obj:"Matter"}),(409==e.status||400==e.status)&&(e=e.response.text),Promise.reject(e)}):Promise.reject({message:"Username/Email and Password are required to login"});if(e.isString(t)){var n=new D({provider:t,app:this});return n.login().then(function(e){return b.info({description:"Provider login successful.",provider:t,res:e,func:"login",obj:"Matter"}),Promise.resolve(e)})}return b.error({description:"Incorrectly fomatted login information.",signupData:signupData,func:"login",obj:"Matter"}),Promise.reject({message:"Login requires an object or a string."})}},{key:"logout",value:function(){var e=this;return this.isLoggedIn?w.put(this.endpoint+"/logout").then(function(t){return b.log({description:"Logout successful.",response:t,func:"logout",obj:"Matter"}),e.currentUser=null,e.token["delete"](),t})["catch"](function(t){return b.error({description:"Error requesting log out: ",error:t,func:"logout",obj:"Matter"}),e.storage.removeItem(h.tokenUserDataName),e.token["delete"](),Promise.reject(t)}):(b.warn({description:"No logged in account to log out.",func:"logout",obj:"Matter"}),Promise.reject({message:"No logged in account to log out."}))}},{key:"getCurrentUser",value:function(){var e=this;return this.storage.item(h.tokenUserDataName)?Promise.resove(this.storage.getItem(h.tokenUserDataName)):this.isLoggedIn?w.get(this.endpoint+"/user").then(function(t){return b.log({description:"Current User Request responded.",responseData:t,func:"currentUser",obj:"Matter"}),e.currentUser=t,t})["catch"](function(e){return 401==e.status?(b.warn({description:"Called for current user without token.",error:e,func:"currentUser",obj:"Matter"}),A["delete"](),Promise.resolve(null)):(b.error({description:"Error requesting current user.",error:e,func:"currentUser",obj:"Matter"}),Promise.reject(e))}):Promise.resolve(null)}},{key:"updateProfile",value:function(e){var t=this;return this.isLoggedIn?(b.warn({description:"Calling update endpoint.",endpoint:this.endpoint+"/user/"+this.token.data.username,func:"updateProfile",obj:"Matter"}),w.put(this.endpoint+"/user/"+this.token.data.username,e).then(function(e){return b.log({description:"Update profile request responded.",responseData:e,func:"updateProfile",obj:"Matter"}),t.currentUser=e,e})["catch"](function(e){return b.error({description:"Error requesting current user.",error:e,func:"updateProfile",obj:"Matter"}),Promise.reject(e)})):(b.error({description:"No current user profile to update.",func:"updateProfile",obj:"Matter"}),Promise.reject({message:"Must be logged in to update profile."}))}},{key:"isInGroup",value:function(t){var r=this;if(!this.isLoggedIn)return b.log({description:"No logged in user to check.",func:"isInGroup",obj:"Matter"}),!1;if(!t||!e.isString(t))return t&&e.isArray(t)?(b.info({description:"Array of groups.",list:t,func:"isInGroup",obj:"Matter"}),this.isInGroups(t)):!1;var n=function(){var n=t,o=n.split(",");if(o.length>1)return b.info({description:"String list of groups.",list:o,func:"isInGroup",obj:"Matter"}),{v:r.isInGroups(o)};var i=r.token.data.groups||[];return b.log({description:"Checking if user is in group.",group:n,userGroups:r.token.data.groups||[],func:"isInGroup",obj:"Matter"}),{v:e.any(i,function(e){return n==e.name})}}();return"object"==typeof n?n.v:void 0}},{key:"isInGroups",value:function(t){var r=this;if(t&&e.isArray(t))return e.map(t,function(t){return r.isInGroup(e.isString(t)?t:t.name)});if(t&&e.isString(t)){var n=t.split(",");return n.length>1?this.isInGroups(n):this.isInGroup(n[0])}b.error({description:"Invalid groups list.",func:"isInGroups",obj:"Matter"})}},{key:"endpoint",get:function(){var t=h.serverUrl;return e.has(this,"options")&&this.options.localServer&&(t="http://localhost:4000",b.info({description:"LocalServer option was set to true. Now server url is local server.",url:t,func:"endpoint",obj:"Matter"})),"tessellate"==this.name?"undefined"!=typeof window&&e.has(window,"location")&&window.location.host===t&&(t="",b.info({description:"Host is Server, serverUrl simplified!",url:t,func:"endpoint",obj:"Matter"})):(t=t+"/apps/"+this.name,b.log({description:"Server url set.",url:t,func:"endpoint",obj:"Matter"})),t}},{key:"currentUser",set:function(e){b.log({description:"Current User set.",user:e,func:"currentUser",obj:"Matter"}),this.storage.setItem(h.tokenUserDataName,e)},get:function(){return this.storage.getItem(h.tokenUserDataName)?this.storage.getItem(h.tokenUserDataName):null}},{key:"storage",get:function(){return v}},{key:"token",get:function(){return A}},{key:"utils",get:function(){return{logger:b,request:w,storage:v,dom:j}}},{key:"isLoggedIn",get:function(){return this.token.string?!0:!1}}]),t}(),P={serverUrl:"http://tessellate.elasticbeanstalk.com",tokenName:"grout",fbUrl:"https://kyper-tech.firebaseio.com/tessellate",appName:"tessellate",matterOptions:{localServer:!1},aws:{region:"us-east-1",cognito:{poolId:"us-east-1:72a20ffd-c638-48b0-b234-3312b3e64b2e",params:{AuthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateUnauth_Role",UnauthRoleArn:"arn:aws:iam::823322155619:role/Cognito_TessellateAuth_Role"}}}},G=new E(P.appName,P.matterOptions),C=G.utils.request,q=G.utils.logger,S=function(){function t(r){if(_classCallCheck(this,t),r&&e.isObject(r)&&(e.has(r,"directoryName")||e.has(r,"name")))this.name=r.directoryName||r.name,e.has(r,"appName")&&(this.appName=r.appName);else{if(!r||!e.isString(r))throw q.error({description:"Action data object with name is required to start a Directory Action.",func:"constructor",obj:"Directory"}),new Error("Directory Data object with name is required to start a Directory action.");this.name=r}}return _createClass(t,[{key:"get",value:function(){return C.get(this.directoryEndpoint).then(function(e){return q.info({description:"Directory data loaded successfully.",directoryData:directoryData,response:e,func:"get",obj:"Directory"}),e})["catch"](function(e){return q.info({description:"Error getting directory.",directoryData:directoryData,error:e,func:"get",obj:"Directory"}),Promise.reject(e)})}},{key:"update",value:function(e){return q.debug({description:"Directory updated called.",directoryData:e,func:"update",obj:"Directory"}),G.utils.request.put(this.directoryEndpoint,e).then(function(t){return q.info({description:"Directory updated successfully.",directoryData:e,response:t,func:"update",obj:"Directory"}),t})["catch"](function(t){return q.error({description:"Error updating directory.",directoryData:e,error:t,func:"update",obj:"Directory"}),Promise.reject(t)})}},{key:"del",value:function(e){return q.debug({description:"Delete directory called.",directoryData:e,func:"del",obj:"Directory"}),C["delete"](this.directoryEndpoint,userData).then(function(t){return q.info({description:"Directory deleted successfully.",directoryData:e,func:"del",obj:"Directory"}),t})["catch"](function(t){return q.error({description:"Error deleting directory.",directoryData:e,error:t,func:"del",obj:"Directory"}),Promise.reject(t)})}},{key:"directoryEndpoint",get:function(){var t=[G.endpoint,"directories",this.name];e.has(this,"app")&&e.has(this.app,"name")&&t.splice(1,0,"apps",this.app.name);var r=t.join("/");return q.log({description:"Directory endpoint built.",endpoint:r,func:"directoryEndpoint",obj:"Directory"}),r}}]),t}(),T=G.utils.request,F=G.utils.logger,N=function(){function t(r){_classCallCheck(this,t),r&&e.isObject(r)&&e.has(r,"app")?(this.app=r.app,F.log({description:"Provided app data set to app parameter.",action:this,providedData:r,func:"constructor",obj:"DirectoriesAction"})):r&&e.isString(r)&&(this.app={name:r},F.log({description:"App name provided as string was set.",action:this,providedData:r,func:"constructor",obj:"DirectoriesAction"})),F.info({description:"New directories action.",action:this,providedData:r,func:"constructor",obj:"DirectoriesAction"})}return _createClass(t,[{key:"get",value:function(){return F.debug({description:"Directories get called.",action:this,func:"get",obj:"DirectoriesAction"}),T.get(this.directoriesEndpoint).then(function(e){return F.info({descrption:"Directories loaded successfully.",response:e,func:"get",obj:"DirectoriesAction"}),e})["catch"](function(e){return F.error({descrption:"error getting users",error:e,func:"get",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return F.debug({description:"Add directory called.",action:this,appData:e,func:"get",obj:"DirectoriesAction"}),T.post(this.directoriesEndpoint,e).then(function(e){return F.log({description:"Application added successfully.",response:e,func:"add",obj:"DirectoriesAction"}),e})["catch"](function(e){return F.error({description:"Error adding group.",error:e,func:"add",obj:"DirectoriesAction"}),Promise.reject(e)})}},{key:"search",value:function(t){var r=this.directoriesEndpoint+"/search/";return t&&e.isString(t)&&(r+=t),t&&""!=t?T.get(r).then(function(e){return F.log({description:"Found directories based on search.",response:e,func:"search",obj:"DirectoriesAction"}),e})["catch"](function(e){return F.error({description:"Error searching directories.",error:e,func:"search",obj:"DirectoriesAction"}),Promise.reject(e)}):(F.debug({description:"Null query, returning empty array.",func:"search",obj:"DirectoriesAction"}),Promise.resolve([]))}},{key:"directoriesEndpoint",get:function(){var t=[G.endpoint,"directories"];e.has(this,"app")&&e.has(this.app,"name")&&t.splice(1,0,"apps",this.app.name);var r=t.join("/");return F.log({description:"Directories endpoint built.",endpoint:r,func:"directoriesEndpoint",obj:"DirectoriesAction"}),r}}]),t}(),I=G.utils.request,U=G.utils.logger,_=function(){function t(r){if(_classCallCheck(this,t),r&&e.isObject(r)&&e.has(r,"groupData"))this.name=e.isObject(r.groupData)?r.groupData.name:r.groupData,e.has(r,"app")&&(this.app=r.app);else{if(!r||!e.isString(r))throw U.error({description:"Action data is required to start a Group Action.",func:"constructor",obj:"Group"}),new Error("Username is required to start an Group");this.name=r}}return _createClass(t,[{key:"get",value:function(){return I.get(this.groupEndpoint).then(function(e){return U.info({description:"Group data loaded successfully.",response:e,func:"get",obj:"Group"}),e})["catch"](function(e){return U.info({description:"Error getting group.",error:e,func:"get",obj:"Group"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(e){return U.log({description:"Group updated called.",groupData:e,func:"update",obj:"Group"}),G.utils.request.put(this.groupEndpoint,e).then(function(t){return U.info({description:"Group updated successfully.",groupData:e,response:t,func:"update",obj:"Group"}),t})["catch"](function(t){return U.error({description:"Error updating group.",groupData:e,error:t,func:"update",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"del",value:function(e){return U.log({description:"Delete group called.",groupData:e,func:"del",obj:"Group"}),I.del(this.groupEndpoint,{}).then(function(t){return U.info({description:"Group deleted successfully.",groupData:e,func:"del",obj:"Group"}),t})["catch"](function(t){return U.error({description:"Error deleting group.",error:t,text:t.response.text,groupData:e,func:"del",obj:"Group"}),Promise.reject(t.response.text||t.response)})}},{key:"addAccounts",value:function(t){U.log({description:"Group updated called.",accountsData:t,func:"update",obj:"Group"});var r=t;return e.isString(t)&&(r=t.split(",")),e.isString(r[0])?(U.error({description:"Accounts array only currently supports account._id not account.username.",accountsData:t,func:"update",obj:"Group"}),Promise.reject({message:"Accounts array only currently supports account._id not account.username."})):(U.log({description:"Updating group with accounts array.",accountsArray:r,func:"update",obj:"Group"}),this.update({accounts:r}).then(function(e){return U.info({description:"Account(s) added to group successfully.",response:e,func:"addAccounts",obj:"Group"}),e})["catch"](function(e){return U.error({description:"Error addAccountseting group.",error:e,func:"addAccounts",obj:"Group"}),Promise.reject(e.response.text||e.response)}))}},{key:"groupEndpoint",get:function(){var t=[G.endpoint,"groups",this.name];e.has(this,"app")&&e.has(this.app,"name")&&t.splice(1,0,"apps",this.app.name);var r=t.join("/");return U.log({description:"Group Endpoint built.",endpoint:r,func:"groupEndpoint",obj:"Group"}),r}}]),t}(),M=G.utils.request,O=G.utils.logger,x=function(){function t(r){_classCallCheck(this,t),r&&e.isObject(r)&&e.has(r,"app")?(this.app=r.app,O.log({description:"Provided app data set to app parameter.",action:this,providedData:r,func:"constructor",obj:"GroupsAction"})):r&&e.isString(r)&&(this.app={name:r},O.log({description:"App name provided as string was set.",action:this,providedData:r,func:"constructor",obj:"GroupsAction"})),O.info({description:"New Groups action.",action:this,providedData:r,func:"constructor",obj:"GroupsAction"})}return _createClass(t,[{key:"get",value:function(){return O.debug({description:"Get group called.",func:"get",obj:"GroupsAction"}),M.get(this.groupsEndpoint).then(function(e){return O.info({description:"Groups loaded successfully.",response:e,func:"get",obj:"GroupsAction"}),e})["catch"](function(e){return O.info({description:"Error getting groups.",error:e,func:"get",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"add",value:function(t){var r=t;return O.debug({description:"Add group called.",groupData:t,func:"add",obj:"GroupsAction"}),e.isString(t)&&(r={name:t}),O.debug({description:"Add group called.",newGroupData:r,func:"add",obj:"GroupsAction"}),M.post(this.groupsEndpoint,r).then(function(e){return O.log({description:"Group added to application successfully.",response:e,func:"add",obj:"GroupsAction"}),e})["catch"](function(e){return O.error({description:"Error adding group.",error:e,func:"add",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"search",value:function(t){if(O.debug({description:"Add group called.",groupData:groupData,func:"search",obj:"GroupsAction"}),!t||""==t||!e.isString(t))return O.log({description:"Null or invalid query, returning empty array.",func:"search",obj:"GroupsAction"}),Promise.resolve([]);var r=this.groupsEndpoint+"/search/"+t;return O.debug({description:"Search endpoint created.",endpoint:r,func:"search",obj:"GroupsAction"}),M.get(r).then(function(e){return O.log({description:"Found groups based on search.",response:e,func:"search",obj:"GroupsAction"}),e})["catch"](function(e){return O.error({description:"Error searching groups.",error:e,func:"search",obj:"GroupsAction"}),Promise.reject(e)})}},{key:"groupsEndpoint",get:function(){var t=[G.endpoint,"groups"];e.has(this,"app")&&e.has(this.app,"name")&&t.splice(1,0,"apps",this.app.name);var r=t.join("/");return O.log({description:"Groups Endpoint built.",endpoint:r,func:"groupsEndpoint",obj:"GroupsAction"}),r}}]),t}(),L=G.utils.request,B=G.utils.logger,H=function(){function t(r){if(_classCallCheck(this,t),r&&e.isObject(r)&&e.has(r,"username"))e.extend(this,r);else{if(!r||!e.isString(r))throw B.error({description:"AccountData is required to start an AccountAction",func:"constructor",obj:"Account"}),new Error("username is required to start an AccountAction");this.username=r}}return _createClass(t,[{key:"get",value:function(){return B.debug({description:"Account data loaded successfully.",func:"get",obj:"Account"}),L.get(this.accountEndpoint).then(function(e){return B.info({description:"Account data loaded successfully.",response:e,func:"get",obj:"Account"}),new t(e)})["catch"](function(e){return B.error({description:"Error getting user.",error:e,func:"get",obj:"Account"}),Promise.reject(e)})}},{key:"update",value:function(e){return B.debug({description:"Update user called.",accountData:e,func:"update",obj:"Account"}),L.put(this.accountEndpoint,e).then(function(e){return B.info({description:"Account updated successfully.",func:"update",obj:"Account"}),new t(e)})["catch"](function(e){return B.error({description:"Error updating user.",func:"update",obj:"Account"}),Promise.reject(e)})}},{key:"del",value:function(e){return B.debug({description:"Delete user called.",func:"del",obj:"Account"}),L.del(this.accountEndpoint,e).then(function(e){return B.info({description:"Delete user successful.",response:e,func:"del",obj:"Account"}),new t(e)})["catch"](function(t){return B.error({description:"Error deleting user.",accountData:e,error:t,func:"del",obj:"Account"}),Promise.reject(t)})}},{key:"accountEndpoint",get:function(){var t=[G.endpoint,"accounts",this.username];e.has(this,"app")&&e.has(this.app,"name")&&t.splice(1,0,"apps",this.app.name);var r=t.join("/");return B.log({description:"Account Endpoint built.",endpoint:r,func:"accountEndpoint",obj:"Account"}),r}}]),t}(),J=G.utils.logger,K=function(){function t(r){_classCallCheck(this,t),r&&e.isObject(r)&&e.has(r,"app")?(this.app=r.app,J.log({description:"Provided app data set to app parameter.",action:this,providedData:r,func:"constructor",obj:"AccountsAction"})):r&&e.isString(r)&&(this.app={name:r},J.log({description:"App name provided as string was set.",action:this,providedData:r,func:"constructor",obj:"AccountsAction"})),J.info({description:"New Accounts action.",action:this,providedData:r,func:"constructor",obj:"AccountsAction"})}return _createClass(t,[{key:"get",value:function(){return J.log({description:"Accounts get called.",func:"get",obj:"AccountsAction"}),G.utils.request.get(this.accountsEndpoint).then(function(e){return J.info({description:"Accounts loaded successfully.",func:"get",obj:"AccountsAction"}),e})["catch"](function(e){return J.info({description:"Error getting accounts.",error:e,func:"get",obj:"AccountsAction"}),Promise.reject(e.message||"Error getting accounts.")})}},{key:"add",value:function(e){return J.info({description:"Account add called.",accountData:e,func:"add",obj:"AccountsAction"}),this.utils.request.post(this.accountsEndpoint,e).then(function(e){return J.info({description:"Account added successfully.",response:e,newAccount:new H(e),func:"add",obj:"AccountsAction"}),new H(e)})["catch"](function(t){return J.error({description:"Account add called.",error:t,accountData:e,func:"add",obj:"AccountsAction"}),Promise.reject(t.message||"Error adding account.")})}},{key:"search",value:function(t){J.log({description:"Accounts search called.",query:t,func:"search",obj:"AccountsAction"});var r=this.accountsEndpoint+"/search/";return t&&e.isString(t)&&(r+=t),t&&""!=t?G.utils.request.get(r).then(function(e){return J.log({description:"Accounts search responded.",response:e,query:t,func:"search",obj:"AccountsAction"}),e})["catch"](function(e){return J.error({description:"Error searching Accounts.",error:e,query:t,func:"search",obj:"AccountsAction"}),Promise.reject(e.message||"Error searching accounts.")}):(J.log({description:"Null query, returning empty array.",func:"search",obj:"AccountsAction"}),Promise.resolve([]))}},{key:"accountsEndpoint",get:function(){var t=[G.endpoint,"accounts"];e.has(this,"app")&&e.has(this.app,"name")&&t.splice(1,0,"apps",this.app.name);var r=t.join("/");return J.log({description:"Accounts Endpoint built.",endpoint:r,func:"accountsEndpoint",obj:"AccountsAction"}),r}}]),t}(),R=G.utils.request,W=G.utils.logger,$=function(){function t(r){if(_classCallCheck(this,t),!r||!e.isString(r))throw W.error({description:"Template data is required to start a Template action.",func:"construcotr",obj:""}),new Error("Template data is required to start a Template action.");this.name=r}return _createClass(t,[{key:"get",value:function(){return W.log({description:"Get template called.",name:this.name,func:"get",obj:"Template"}),R.get(this.templateEndpoint).then(function(e){return W.log({description:"Get template responded.",response:e,func:"get",obj:"Template"}),e})["catch"](function(e){return W.error({description:"Error getting template.",error:e,func:"get",obj:"Template"
}),Promise.reject(e)})}},{key:"update",value:function(e){return W.log({description:"Update template called.",templateData:e,func:"update",obj:"Template"}),R.put(this.templateEndpoint,e).then(function(t){return W.log({description:"Update template responded.",response:t,templateData:e,func:"update",obj:"Template"}),t})["catch"](function(e){return W.error({description:"Error updating template.",error:e,func:"update",obj:"Template"}),Promise.reject(e)})}},{key:"del",value:function(e){return W.log({description:"Delete template called.",templateData:e,func:"del",obj:"Template"}),R["delete"](this.endpoint,e).then(function(e){return W.log({description:"Template deleted successfully.",response:e,func:"del",obj:"Template"}),e})["catch"](function(e){return W.error({description:"Error deleting template.",error:e,func:"del",obj:"Template"}),Promise.reject(e)})}},{key:"templateEndpoint",get:function(){return G.endpoint+"/templates/"+this.name}}]),t}(),z=G.utils.logger,V=G.utils.request,Y=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"get",value:function(){return z.log({description:"Get template called.",func:"get",obj:"TemplatesAction"}),V.get(this.templatesEndpoint).then(function(e){return z.log({description:"Templates loaded.",response:e,func:"get",obj:"TemplatesAction"}),e})["catch"](function(e){return z.error({description:"Error getting templates.",error:e,func:"get",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return z.log({description:"Add template called.",func:"add",obj:"TemplatesAction"}),V.post(this.templatesEndpoint,e).then(function(e){return z.log({description:"Templates added successfully.",func:"add",obj:"TemplatesAction"}),e})["catch"](function(e){return z.error({description:"Error adding template.",error:e,func:"add",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"search",value:function(t){z.log({description:"Search template called.",query:t,func:"search",obj:"TemplatesAction"});var r=this.templatesEndpoint+"/search/";return t&&e.isString(t)&&(r+=t),z.log({description:"Search endpoint created.",endpoint:r,func:"search",obj:"TemplatesAction"}),V.get(r).then(function(e){return z.log({description:"Template(s) found successfully.",response:e,endpoint:r,func:"search",obj:"TemplatesAction"}),e})["catch"](function(e){return z.log({description:"Error searching for templates.",query:t,error:e,endpoint:r,func:"search",obj:"TemplatesAction"}),Promise.reject(e)})}},{key:"templatesEndpoint",get:function(){var t=[G.endpoint,"templates"];e.has(this,"app")&&e.has(this.app,"name")&&z.log({description:"Templates action is not currently supported for a specific application.",func:"accountsEndpoint",obj:"AccountsAction"});var r=t.join("/");return z.log({description:"Templates endpoint built.",endpoint:r,func:"templatesEndpoint",obj:"TemplatesAction"}),r}}]),t}(),Q=G.utils.logger,X=function(){function t(r){if(_classCallCheck(this,t),!(r&&e.isObject(r)&&e.has(r,["path","app"])))throw r&&!e.isObject(r)?(Q.error({description:"File data is not an object. File data must be an object that includes path and appName.",func:"constructor",obj:"File"}),new Error("File data must be an object that includes path and appName.")):(Q.error({description:"File data include path and app is needed to create a File action.",func:"constructor",obj:"File"}),new Error("File data with path and app is needed to create file action."));this.path=r.path,this.app=r.app,this.pathArray=this.path.split("/"),this.name=e.has(r,"name")?r.name:this.pathArray[this.pathArray.length-1],this.type="file",Q.debug({description:"File object constructed.",file:this,func:"constructor",obj:"File"})}return _createClass(t,[{key:"get",value:function(){if(this.app&&this.app.frontend){var e={Bucket:this.app.frontend.bucketName,Key:this.path};return fileData.contentType&&(e.ContentType=fileData.contentType),Q.debug({description:"File get params built.",saveParams:e,fileData:fileData,func:"get",obj:"File"}),s3.getObject(e,function(e,t){return e?(Q.error({description:"Error loading file from S3.",error:e,func:"get",obj:"File"}),Promise.reject(e)):(Q.error({description:"File loaded successfully.",fileData:t,func:"get",obj:"File"}),t)})}return Q.error({description:"Application Frontend data not available. Make sure to call .get().",func:"get",obj:"File"}),Promise.reject({message:"Front end data is required to get file."})}},{key:"open",value:function(){return this.get}},{key:"publish",value:function(t){if(Q.debug({description:"File publish called.",file:this,fileData:t,func:"publish",obj:"File"}),this.app.frontend){if(!e.has(t,["content","path"]))return Q.error({description:"File data including path and content required to publish.",func:"publish",obj:"File"}),Promise.reject({message:"File data including path and content required to publish."});var r={Bucket:this.app.frontend.bucketName,Key:t.path,Body:t.content,ACL:"public-read"};return t.contentType&&(r.ContentType=t.contentType),"undefined"!=typeof n.config.credentials&&n.config.credentials||(Q.debug({description:"AWS creds do not exist, so they are being set.",func:"publish",obj:"File"}),p()),Q.debug({description:"File publish params built.",saveParams:r,fileData:t,func:"publish",obj:"File"}),s3.putObject(r,function(e,t){return e?(Q.error({description:"Error saving file to S3.",error:e,func:"publish",obj:"File"}),Promise.reject(e)):(Q.error({description:"File saved successfully.",fileData:t,func:"publish",obj:"File"}),t)})}return Q.error({description:"Application Frontend data not available. Make sure to call .get().",func:"publish",obj:"File"}),Promise.reject({message:"Front end data is required to publish file."})}},{key:"getTypes",value:function(){}},{key:"openWithFirepad",value:function(e){}},{key:"getDefaultContent",value:function(){}},{key:"ext",get:function(){var e=/(?:\.([^.]+))?$/;this.ext=e.exec(this.name)[1]}}]),t}(),Z=G.utils.logger,ee=function(){function t(r){if(_classCallCheck(this,t),r&&e.isObject(r)&&e.has(r,"app"))this.app=r.app;else{if(!r||!e.isString(r))throw r&&e.isArray(r)?(Z.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with application is required to start a Files action.")):(Z.error({description:"Action data object with name is required to start a Files Action.",func:"constructor",obj:"Files"}),new Error("Files Data object with name is required to start a Files action."));this.app={name:r}}Z.debug({description:"Files object constructed.",func:"constructor",obj:"Files"})}return _createClass(t,[{key:"publish",value:function(){}},{key:"get",value:function(){var e=this;if(!this.app.frontend||!this.app.frontend.bucketName)return Z.warn({description:"Application Frontend data not available. Calling .get().",app:this.app,func:"get",obj:"Files"}),this.app.get().then(function(t){return Z.warn({description:"Get returned",data:t,func:"get",obj:"Files"}),e.app=t,e.get()},function(e){return Z.error({description:"Application Frontend data not available. Make sure to call .get().",func:"get",obj:"Files"}),Promise.reject({message:"Bucket name required to get objects"})});var t=function(){"undefined"!=typeof n.config.credentials&&n.config.credentials||l();var t=new n.S3,r={Bucket:e.app.frontend.bucketName};return{v:new Promise(function(e,n){t.listObjects(r,function(t,r){return t?(Z.error({description:"Error getting files from S3.",error:t,func:"get",obj:"Files"}),n(t)):(Z.info({description:"Files list loaded.",filesData:r,func:"get",obj:"Files"}),e(r.Contents))})})}}();return"object"==typeof t?t.v:void 0}},{key:"add",value:function(){}},{key:"del",value:function(){}},{key:"buildStructure",value:function(){return Z.debug({description:"Build Structure called.",func:"buildStructure",obj:"Application"}),this.get().then(function(e){var t=d(e);return Z.log({description:"Child struct from array.",childStructure:t,func:"buildStructure",obj:"Application"}),t},function(e){return Z.error({description:"Error getting application files.",error:e,func:"buildStructure",obj:"Application"}),Promise.reject({message:"Error getting files.",error:e})})}}]),t}(),te=G.utils.request,re=G.utils.logger,ne=function(){function t(r){_classCallCheck(this,t),r&&e.isObject(r)?e.extend(this,r):r&&e.isString(r)&&(this.name=r),o&&e.has(P,"fbUrl")&&e.has(this,"name")&&(this.fbRef=new o(P.fbUrl+this.name))}return _createClass(t,[{key:"get",value:function(){return re.debug({description:"Application get called.",func:"get",obj:"Application"}),te.get(this.appEndpoint).then(function(e){return re.info({description:"Application loaded successfully.",response:e,application:new t(e),func:"get",obj:"Application"}),new t(e)})["catch"](function(e){return re.error({description:"Error getting Application.",message:e.response.text,error:e,func:"get",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"update",value:function(e){return re.debug({description:"Application update called.",func:"update",obj:"Application"}),te.put(this.appEndpoint,e).then(function(e){return re.info({description:"Application updated successfully.",response:e,func:"update",obj:"Application"}),new t(e)})["catch"](function(e){return re.error({description:"Error updating application.",error:e,func:"update",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"addStorage",value:function(){return re.debug({description:"Application add storage called.",application:this,func:"addStorage",obj:"Application"}),te.post(this.appEndpoint+"/storage",appData).then(function(e){return re.info({description:"Storage successfully added to application.",response:e,application:new t(e),func:"addStorage",obj:"Application"}),new t(e)})["catch"](function(e){return re.error({description:"Error adding storage to application.",error:e,func:"addStorage",obj:"Application"}),Promise.reject(e.response.text||e.response)})}},{key:"applyTemplate",value:function(){var e=this;return re.error({description:"Applying templates to existing applications is not currently supported.",func:"applyTemplate",obj:"Application"}),te.post(this.appEndpoint,appData).then(function(r){return re.info({description:"Template successfully applied to application.",response:r,application:e,func:"applyTemplate",obj:"Application"}),new t(r)})["catch"](function(t){return re.error({description:"Error applying template to application.",error:t,application:e,func:"applyTemplate",obj:"Application"}),Promise.reject(t.response.text||t.response)})}},{key:"File",value:function(e){return re.debug({description:"Applications file action called.",fileData:e,application:this,func:"file",obj:"Application"}),new X({app:this,fileData:e})}},{key:"User",value:function(e){return re.debug({description:"Applications user action called.",userData:e,application:this,func:"user",obj:"Application"}),new H({app:this,userData:e})}},{key:"Account",value:function(e){return re.debug({description:"Applications account action called.",userData:e,application:this,func:"user",obj:"Application"}),new H({app:this,userData:e})}},{key:"Group",value:function(e){return re.debug({description:"Applications group action called.",groupData:e,application:this,func:"group",obj:"Application"}),new _({app:this,groupData:e})}},{key:"Directory",value:function(e){return re.debug({description:"Applications directory action called.",directoryData:e,application:this,func:"directory",obj:"Application"}),new S({app:this,directoryData:e})}},{key:"appEndpoint",get:function(){return G.endpoint+"/apps/"+this.name}},{key:"Files",get:function(){return re.debug({description:"Applications files action called.",application:this,func:"files",obj:"Application"}),new ee({app:this})}},{key:"Users",get:function(){return re.debug({description:"Applications users action called.",application:this,func:"user",obj:"Application"}),new K({app:this})}},{key:"Accounts",get:function(){return re.debug({description:"Applications account action called.",application:this,func:"user",obj:"Application"}),new K({app:this})}},{key:"Groups",get:function(){return re.debug({description:"Applications groups action called.",application:this,func:"groups",obj:"Application"}),new x({app:this})}},{key:"Directories",get:function(){return re.debug({description:"Applications directories action called.",application:this,func:"directories",obj:"Application"}),new N({app:this})}}]),t}(),oe=G.utils.request,ie=G.utils.logger,se=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(){return ie.debug({description:"Apps get called.",action:this,func:"get",obj:"AppsAction"}),oe.get(this.appsEndpoint).then(function(e){return ie.info({description:"Apps data loaded successfully.",response:e,func:"get",obj:"AppsAction"}),e})["catch"](function(e){return ie.error({description:"Error getting apps data.",error:e,func:"get",obj:"AppsAction"}),Promise.reject(e)})}},{key:"add",value:function(e){return ie.debug({description:"Application add called.",appData:e,func:"add",obj:"AppsAction"}),G.utils.request.post(this.appsEndpoint,e).then(function(e){return ie.info({description:"Application added successfully.",response:e,func:"add",obj:"AppsAction"}),e})["catch"](function(e){return ie.error({description:"Error adding app.",error:e,func:"add",obj:"AppsAction"}),Promise.reject(e)})}},{key:"appsEndpoint",get:function(){return G.endpoint+"/apps"}}]),e}(),ce=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,P.appName,P.matterOptions)}return _inherits(t,e),_createClass(t,[{key:"App",value:function(e){return this.utils.logger.debug({description:"Application action called.",appName:e,template:new ne(e),func:"App",obj:"Grout"}),new ne(e)}},{key:"Template",value:function(e){return this.utils.logger.debug({description:"Template Action called.",templateData:e,template:new $(e),func:"Template",obj:"Grout"}),new $(e)}},{key:"Account",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new H(e),func:"user",obj:"Grout"}),new H(e)}},{key:"User",value:function(e){return this.utils.logger.debug({description:"Account Action called.",userData:e,user:new H(e),func:"user",obj:"Grout"}),new H(e)}},{key:"Group",value:function(e){return this.utils.logger.debug({description:"Group Action called.",groupData:e,action:new _({app:this,groupData:e}),func:"group",obj:"Grout"}),new _(e)}},{key:"Directory",value:function(e){return this.utils.logger.debug({description:"Directory Action called.",directoryData:e,action:new S(e),func:"directory",obj:"Grout"}),new S(e)}},{key:"Apps",get:function(){return this.utils.logger.debug({description:"Apps Action called.",action:new se,func:"Apps",obj:"Grout"}),new se}},{key:"Templates",get:function(){return this.utils.logger.debug({description:"Templates Action called.",action:new Y,func:"Templates",obj:"Grout"}),new Y}},{key:"Accounts",get:function(){return this.utils.logger.debug({description:"Account Action called.",action:new K,func:"users",obj:"Grout"}),new K}},{key:"Users",get:function(){return this.utils.logger.debug({description:"Accounts Action called.",action:new K,func:"Users",obj:"Grout"}),new K}},{key:"Groups",get:function(){return this.utils.logger.debug({description:"Groups Action called.",action:new x,func:"groups",obj:"Grout"}),new x}},{key:"Directories",get:function(){return this.utils.logger.debug({description:"Directories Action called.",action:new N,func:"directories",obj:"Grout"}),new N}}]),t}(E);return ce});
//# sourceMappingURL=grout.min.js.map